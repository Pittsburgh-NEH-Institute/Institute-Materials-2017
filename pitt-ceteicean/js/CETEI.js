var CETEI=function(){"use strict";var e={};e["typeof"]="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},e.classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}();var t={handlers:{eg:["<pre>","</pre>"],ptr:['<a href="$rw@target">$@target</a>'],ref:['<a href="$rw@target">',"</a>"],graphic:function(e){var t=new Image;return t.src=this.rw(e.getAttribute("url")),e.hasAttribute("width")&&t.setAttribute("width",e.getAttribute("width")),e.hasAttribute("height")&&t.setAttribute("height",e.getAttribute("height")),t},list:function(e){if(e.hasAttribute("type")&&"gloss"==e.getAttribute("type")){var t=document.createElement("dl"),r=!0,a=!1,n=void 0;try{for(var i,o=Array.from(e.children)[Symbol.iterator]();!(r=(i=o.next()).done);r=!0){var l=i.value;if(l.nodeType==Node.ELEMENT_NODE){if("tei-label"==l.localName){var s=document.createElement("dt");s.innerHTML=l.innerHTML,t.appendChild(s)}if("tei-item"==l.localName){var u=document.createElement("dd");u.innerHTML=l.innerHTML,t.appendChild(u)}}}}catch(c){a=!0,n=c}finally{try{!r&&o["return"]&&o["return"]()}finally{if(a)throw n}}return t}return null},table:function n(e){var n=document.createElement("table");if(n.innerHTML=e.innerHTML,"tei-head"==n.firstElementChild.localName){var t=n.firstElementChild;t.remove();var r=document.createElement("caption");r.innerHTML=t.innerHTML,n.appendChild(r)}var a=!0,i=!1,o=void 0;try{for(var l,s=Array.from(n.querySelectorAll("tei-row"))[Symbol.iterator]();!(a=(l=s.next()).done);a=!0){var u=l.value,c=document.createElement("tr");c.innerHTML=u.innerHTML;var d=!0,h=!1,f=void 0;try{for(var m,v=Array.from(u.attributes)[Symbol.iterator]();!(d=(m=v.next()).done);d=!0){var y=m.value;c.setAttribute(y.name,y.value)}}catch(p){h=!0,f=p}finally{try{!d&&v["return"]&&v["return"]()}finally{if(h)throw f}}u.parentElement.replaceChild(c,u)}}catch(p){i=!0,o=p}finally{try{!a&&s["return"]&&s["return"]()}finally{if(i)throw o}}var b=!0,g=!1,w=void 0;try{for(var E,T=Array.from(n.querySelectorAll("tei-cell"))[Symbol.iterator]();!(b=(E=T.next()).done);b=!0){var A=E.value,N=document.createElement("td");A.hasAttribute("cols")&&N.setAttribute("colspan",A.getAttribute("cols")),N.innerHTML=A.innerHTML;var S=!0,k=!1,M=void 0;try{for(var L,x=Array.from(A.attributes)[Symbol.iterator]();!(S=(L=x.next()).done);S=!0){var C=L.value;N.setAttribute(C.name,C.value)}}catch(p){k=!0,M=p}finally{try{!S&&x["return"]&&x["return"]()}finally{if(k)throw M}}A.parentElement.replaceChild(N,A)}}catch(p){g=!0,w=p}finally{try{!b&&T["return"]&&T["return"]()}finally{if(g)throw w}}return n},egXML:function(e){var t=document.createElement("pre");return t.innerHTML=this.serialize(e,!0),t}}},r=function(){function r(a){if(e.classCallCheck(this,r),this.els=[],this.behaviors=[],this.hasStyle=!1,this.prefixes=[],a)this.base=a;else try{window&&(this.base=window.location.href.replace(/\/[^\/]*$/,"/"))}catch(n){this.base=""}this.behaviors.push(t),this.shadowCSS,this.supportsShadowDom=document.head.createShadowRoot||document.head.attachShadow}return e.createClass(r,[{key:"getHTML5",value:function(e,t,r){var a=this;window.location.href.startsWith(this.base)&&e.indexOf("/")>=0&&(this.base=e.replace(/\/[^\/]*$/,"/"));var n=new Promise(function(t,r){var a=new XMLHttpRequest;a.open("GET",e),a.send(),a.onload=function(){this.status>=200&&this.status<300?t(this.response):r(this.statusText)},a.onerror=function(){r(this.statusText)}})["catch"](function(e){console.log(e)});return n.then(function(e){return a.makeHTML5(e,t,r)})}},{key:"makeHTML5",value:function(e,t,r){var a=(new DOMParser).parseFromString(e,"text/xml");return this.domToHTML5(a,t,r)}},{key:"domToHTML5",value:function(e,t,r){var a=this;this._fromTEI(e);var n=function i(e){var t=void 0,n=!1;switch(e.namespaceURI){case"http://www.tei-c.org/ns/1.0":t=document.createElement("tei-"+e.tagName);break;case"http://www.tei-c.org/ns/Examples":t=document.createElement("teieg-"+e.tagName);break;case"http://relaxng.org/ns/structure/1.0":t=document.createElement("rng-"+e.tagName);break;default:t=document.importNode(e,!1),n=!0}var o=!0,l=!1,s=void 0;try{for(var u,c=Array.from(e.attributes)[Symbol.iterator]();!(o=(u=c.next()).done);o=!0){var d=u.value;!d.name.startsWith("xmlns")||n?t.setAttribute(d.name,d.value):"xmlns"==d.name&&t.setAttribute("data-xmlns",d.value),"xml:id"!=d.name||n||t.setAttribute("id",d.value),"xml:lang"!=d.name||n||t.setAttribute("lang",d.value),"rendition"==d.name&&t.setAttribute("class",d.value.replace(/#/g,""))}}catch(h){l=!0,s=h}finally{try{!o&&c["return"]&&c["return"]()}finally{if(l)throw s}}if(t.setAttribute("data-teiname",e.localName),0==e.childNodes.length&&t.setAttribute("data-empty",""),"tagsDecl"==e.localName){var f=document.createElement("style"),m=!0,v=!1,y=void 0;try{for(var p,b=Array.from(e.childNodes)[Symbol.iterator]();!(m=(p=b.next()).done);m=!0){var g=p.value;if(g.nodeType==Node.ELEMENT_NODE&&"rendition"==g.localName&&"css"==g.getAttribute("scheme")){var w="";g.hasAttribute("selector")?(w+=g.getAttribute("selector").replace(/([^#, >]+\w*)/g,"tei-$1").replace(/#tei-/g,"#")+"{\n",w+=g.textContent):(w+="."+g.getAttribute("xml:id")+"{\n",w+=g.textContent),w+="\n}\n",f.appendChild(document.createTextNode(w))}}}catch(h){v=!0,y=h}finally{try{!m&&b["return"]&&b["return"]()}finally{if(v)throw y}}f.childNodes.length>0&&(t.appendChild(f),a.hasStyle=!0)}"prefixDef"==e.localName&&(a.prefixes.push(e.getAttribute("ident")),a.prefixes[e.getAttribute("ident")]={matchPattern:e.getAttribute("matchPattern"),replacementPattern:e.getAttribute("replacementPattern")});var E=!0,T=!1,A=void 0;try{for(var N,S=Array.from(e.childNodes)[Symbol.iterator]();!(E=(N=S.next()).done);E=!0){var k=N.value;k.nodeType==Node.ELEMENT_NODE?t.appendChild(i(k)):t.appendChild(k.cloneNode())}}catch(h){T=!0,A=h}finally{try{!E&&S["return"]&&S["return"]()}finally{if(T)throw A}}return r&&r(t),t};return this.dom=n(e.documentElement),document.registerElement?this.registerAll(this.els):this.fallback(this.els),this.done=!0,t?void t(this.dom,this):this.dom}},{key:"addStyle",value:function(e,t){this.hasStyle&&e.getElementsByTagName("head").item(0).appendChild(t.getElementsByTagName("style").item(0).cloneNode(!0))}},{key:"addShadowStyle",value:function(e){this.shadowCSS&&(e.innerHTML='<style>@import url("'+this.shadowCSS+'");</style>'+e.innerHTML)}},{key:"addBehaviors",value:function(e){e.handlers||e.fallbacks?this.behaviors.push(e):console.log("No handlers or fallback methods found.")}},{key:"setBaseUrl",value:function(e){this.base=e}},{key:"_fromTEI",value:function(e){var t=e.documentElement;this.els=new Set(Array.from(t.getElementsByTagNameNS("http://www.tei-c.org/ns/1.0","*"),function(e){return e.tagName})),this.els.add("egXML"),this.els.add(t.tagName)}},{key:"_insert",value:function(e,t){var r=document.createElement("span");return t.length>1?t[0].includes("<")&&t[1].includes("</")?r.innerHTML=t[0]+e.innerHTML+t[1]:r.innerHTML="<span>"+t[0]+"</span>"+e.innerHTML+"<span>"+t[1]+"</span>":t[0].includes("<")?r.innerHTML=t[0]+e.innerHTML:r.innerHTML="<span>"+t[0]+"</span>"+e.innerHTML,r.children.length>1?r:r.children[0]}},{key:"_template",value:function(e,t){var r=e;if(e.search(/$(\w*)@(\w+)/))for(var a=/\$(\w*)@(\w+)/g,n=void 0;n=a.exec(e);)t.hasAttribute(n[2])&&(r=n[1]&&this[n[1]]?r.replace(n[0],this[n[1]].call(this,t.getAttribute(n[2]))):r.replace(n[0],t.getAttribute(n[2])));return r}},{key:"tagName",value:function(e){return"egXML"==e?"teieg-"+e:"tei-"+e}},{key:"decorator",value:function(e){var t=this;return function(r){for(var a=[],n=0;n<e.length;n++)a.push(t._template(e[n],r));return t._insert(r,a)}}},{key:"getHandler",value:function(e){for(var t=this.behaviors.length-1;t>=0;t--)if(this.behaviors[t].handlers[e])return Array.isArray(this.behaviors[t].handlers[e])?this.append(this.decorator(this.behaviors[t].handlers[e])):this.append(this.behaviors[t].handlers[e])}},{key:"getFallback",value:function(e){for(var t=this.behaviors.length-1;t>=0;t--)if(this.behaviors[t].handlers[e])return Array.isArray(this.behaviors[t].handlers[e])?this.decorator(this.behaviors[t].handlers[e]):this.behaviors[t].handlers[e]}},{key:"append",value:function(t,r){var a=this;if(r){var n=t.call(this,r);n&&!r.querySelector(":scope > "+n.nodeName)&&(this.supportsShadowDom?this._appendShadow(r,n):this._appendBasic(r,n))}else{var i=function(){var e=a;return a.supportsShadowDom?{v:function(){var r=t.call(e,this);r&&e._appendShadow(this,r)}}:{v:function(){var r=t.call(e,this);r&&!this.querySelector(":scope > "+r.nodeName)&&e._appendBasic(this,r)}}}();if("object"===("undefined"==typeof i?"undefined":e["typeof"](i)))return i.v}}},{key:"_appendShadow",value:function(e,t){var r=e.attachShadow({mode:"open"});this.addShadowStyle(r),r.appendChild(t)}},{key:"_appendBasic",value:function(e,t){this.hideContent(e),e.appendChild(t)}},{key:"registerAll",value:function(e){var t=!0,r=!1,a=void 0;try{for(var n,i=e[Symbol.iterator]();!(t=(n=i.next()).done);t=!0){var o=n.value,l=Object.create(HTMLElement.prototype),s=this.getHandler(o);s&&(l.createdCallback=s);var u=this.tagName(o);try{document.registerElement(u,{prototype:l})}catch(c){console.log(u+" couldn't be registered or is already registered."),console.log(c)}}}catch(d){r=!0,a=d}finally{try{!t&&i["return"]&&i["return"]()}finally{if(r)throw a}}}},{key:"fallback",value:function(e){var t=!0,r=!1,a=void 0;try{for(var n,i=e[Symbol.iterator]();!(t=(n=i.next()).done);t=!0){var o=n.value,l=this.getFallback(o);if(l){var s=!0,u=!1,c=void 0;try{for(var d,h=Array.from(this.dom.getElementsByTagName(this.tagName(o)))[Symbol.iterator]();!(s=(d=h.next()).done);s=!0){var f=d.value;this.append(l,f)}}catch(m){u=!0,c=m}finally{try{!s&&h["return"]&&h["return"]()}finally{if(u)throw c}}}}}catch(m){r=!0,a=m}finally{try{!t&&i["return"]&&i["return"]()}finally{if(r)throw a}}}},{key:"rw",value:function(e){return e.match(/^(?:http|mailto|file|\/|#).*$/)?e:this.base+e}},{key:"first",value:function(e){return e.replace(/ .*$/,"")}},{key:"serialize",value:function(e,t){var r="";if(!t){r+="&lt;"+e.getAttribute("data-teiname");var a=!0,n=!1,i=void 0;try{for(var o,l=Array.from(e.attributes)[Symbol.iterator]();!(a=(o=l.next()).done);a=!0){var s=o.value;s.name.startsWith("data-")||["id","lang","class"].includes(s.name)||(r+=" "+s.name+'="'+s.value+'"'),"data-xmlns"==s.name&&(r+=' xmlns="'+s.value+'"')}}catch(u){n=!0,i=u}finally{try{!a&&l["return"]&&l["return"]()}finally{if(n)throw i}}r+=e.childNodes.length>0?">":"/>"}var c=!0,d=!1,h=void 0;try{for(var f,m=Array.from(e.childNodes)[Symbol.iterator]();!(c=(f=m.next()).done);c=!0){var v=f.value;switch(v.nodeType){case Node.ELEMENT_NODE:r+=this.serialize(v);break;case Node.PROCESSING_INSTRUCTION_NODE:r+="&lt;?"+v.nodeValue+"?>";break;case Node.COMMENT_NODE:r+="&lt;!--"+v.nodeValue+"-->";break;default:r+=v.nodeValue.replace(/</g,"&lt;")}}}catch(u){d=!0,h=u}finally{try{!c&&m["return"]&&m["return"]()}finally{if(d)throw h}}return!t&&e.childNodes.length>0&&(r+="&lt;/"+e.getAttribute("data-teiname")+">"),r}},{key:"hideContent",value:function(e){if(e.childNodes.length>0){var t=e.innerHTML;e.innerHTML="";var r=document.createElement("span");r.setAttribute("style","display:none;"),r.setAttribute("class","hide"),r.innerHTML=t,e.appendChild(r)}}},{key:"unEscapeEntities",value:function(e){return e.replace(/&gt;/,">").replace(/&quot;/,'"').replace(/&apos;/,"'").replace(/&amp;/,"&")}},{key:"fromODD",value:function(){}}],[{key:"savePosition",value:function(){window.localStorage.setItem("scroll",window.scrollY)}},{key:"restorePosition",value:function(){window.localStorage.getItem("scroll")&&setTimeout(function(){window.scrollTo(0,localStorage.getItem("scroll"))},100)}}]),r}();try{window&&(window.CETEI=r,window.addEventListener("beforeunload",r.savePosition),window.addEventListener("load",r.restorePosition))}catch(a){}return r}();